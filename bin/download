#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=../lib/defs.sh
. "$(dirname "$0")/../lib/defs.sh"
exec > >(log_stream) 2> >(error_stream)

target="$ASDF_DOWNLOAD_PATH/$jar_file"

# Workaround for some jar names not following the same pattern 
case "$ASDF_INSTALL_VERSION" in
1.3.1)
    source='https://dl.bintray.com/tigervnc/stable/VncViewer.jar'
    ;;
*)
    source="https://dl.bintray.com/tigervnc/stable/VncViewer-$ASDF_INSTALL_VERSION.jar"
    ;;
esac

[ "$ASDF_INSTALL_TYPE" = "version" ] || { error "can only handle version installations"; exit 1; }

log "downloading version $ASDF_INSTALL_VERSION"
curl -L "$source" > "$target" || { rm -f "$target"; error "download failed"; exit 1; }
