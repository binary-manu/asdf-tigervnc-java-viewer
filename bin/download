#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=../lib/defs.sh
. "$(dirname "$0")/../lib/defs.sh"
exec > >(log_stream) 2> >(error_stream)

target="$ASDF_DOWNLOAD_PATH/$jar_file"
source="https://github.com/accetto/tigervnc/releases/download/v$ASDF_INSTALL_VERSION-mirror/VncViewer-$ASDF_INSTALL_VERSION.jar"
curl_opts=(-fL --no-progress-meter)
if [ -n "${GITHUB_API_TOKEN:-}" ]; then
  curl_opts=("${curl_opts[@]}" -H "Authorization: token $GITHUB_API_TOKEN")
fi

[ "$ASDF_INSTALL_TYPE" = "version" ] || { error "can only handle version installations"; exit 1; }

log "downloading version $ASDF_INSTALL_VERSION"
curl "${curl_opts[@]}" "$source" -o "$target" || { rm -f "$target"; error "download failed"; exit 1; }
